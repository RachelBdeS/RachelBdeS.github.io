<!-- A FAIRE 
  • Page à appeler via le formulaire
-->
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <link href="./css/AFPA_Web_Partie3_d.css" rel="stylesheet">
    <title>Controles de saisie</title>
  </head>
  <body role="main">
    <form action="" method="GET" name="user">

      <h1>Controles de saisie</h1>

      <label>Nom : </label>
      <input type="text" name="nom" value="" placeholder="nom *" tabindex="1" required>

      <label>Prénom : </label>
      <input type="text" name="prenom" value="" placeholder="prénom *" tabindex="2" required>

      <label>Numéro : </label>
      <input type="number" name="numero" value="" placeholder="numéro membre" class="nombre" tabindex="3" maxlength="8">

      <label>Rue : </label>
      <input type="text" name="rue" value="" placeholder="numéro et nom de rue *" tabindex="4" required>

      <label>Ville : </label>
      <input type="text" name="ville" value="" placeholder="ville" tabindex="5">
      
      <label>CP : </label>
      <input type="number" name="cp" value="" placeholder="code postal" class="nombre" tabindex="6" maxlength="5">

      <label>Email : </label>
      <input type="text" name="mel" value="" placeholder="mél" tabindex="7">

      <label>Téléphone : </label>
      <input type="number" name="tel" value="" placeholder="numéro de téléphone" class="nombre" tabindex="8" maxlength="10">

      <button type="submit" tabindex="9" disabled="true">Validation</button>

      <p class="alert"></p>

    </form>
    <script>
      //#region -[ DECLARATIONS PUBLIQUES ]
      var toast=``;
      //#endregion

      //#region -[ LISTERNERS sur les champs du formulaire ]
        with (document.forms.user.nom) 
        {
          // Si le champs nom perd le focus,
          onblur=function() 
          {
            let estOk = verifChamp(this, this.required, 2, 99);
            let cible = document.querySelector('[type="submit"]');
            actualizeBouton(estOk, cible);
          }

          // Si une touche est pressée dans le champs nom,
          onkeyup=function()
          {
            verifChamp(this, this.required, 2, 99);
          }
        }
        with (document.forms.user.prenom) 
        {
          // Si le champs prénom perd le focus,
          onblur=function() 
          {
            let estOk = verifChamp(this, this.required, 2, 99);
            let cible = document.querySelector('[type="submit"]');
            actualizeBouton(estOk, cible);
          }

          // Si une touche est pressée dans le champs prénom,
          onkeyup=function() 
          {
            verifChamp(this, this.required, 2, 99);
          }
        }
        with (document.forms.user.numero) 
        {
          // Si le champs numéro de client perd le focus,
          onblur=function() 
          {
            let estOk = verifChamp(this, this.required, 8, 8);
            let cible = document.querySelector('[type="submit"]');
            actualizeBouton(estOk, cible);
          }
          // Si une touche est pressée dans le champs numéro de client,
          onkeyup=function() 
          {
            verifChamp(this, this.required, 8, 8);
          }
        }
        with (document.forms.user.rue) 
        {
          // Si le champs rue perd le focus,
          onblur=function() 
          {
            let estOk = verifChamp(this, this.required, 3, 99);
            let cible = document.querySelector('[type="submit"]');
            actualizeBouton(estOk, cible);
          }
          
          // Si une touche est pressée dans le champs rue,
          onkeyup=function() 
          {
            verifChamp(this, this.required, 3, 99);
          }
        }
        with (document.forms.user.ville) 
        {
          // Si le champs ville perd le focus,
          onblur=function() 
          {
            let estOk = verifChamp(this, this.required, 2, 99);
            let cible = document.querySelector('[type="submit"]');
            actualizeBouton(estOk, cible);
          }

          // Si une touche est pressée dans le champs ville,
          onkeyup=function() 
          {
            verifChamp(this, this.required, 2, 99);
          }
        }
        with (document.forms.user.cp) 
        {
          // Si le champs cp perd le focus,
          onblur=function() 
          {
            let estOk = verifChamp(this, this.required, 5, 5);
            let cible = document.querySelector('[type="submit"]');
            actualizeBouton(estOk, cible);
          }

          // Si une touche est pressée dans le cp,
          onkeyup=function() 
          {
            verifChamp(this, this.required, 5, 5);
          }
        }
        with (document.forms.user.mel) 
        {
          var eMailRules=/[a-z]{1}[a-z0-9\_\-\.]*\@[a-z0-9\_\-\.]*\.[a-z]{2,3}/;

          // Si le champs mél perd le focus,
          onblur=function() 
          {
            // Déclarations et initialisations
            if (this.value) {this.value.style.fontVariant='none'}

            // Si la semantique du mél renseigné est valide,
            if (eMailRules.test(this.value))
            {
              document.querySelector('p.alert').innerHTML=``;
              champs.style.borderColor='#ccccccff';
            }
            // Si la semantique du mél renseigné est incorrecte,
            else
            {
              toast=`Le ${champs.placeholder} doit être sous la forme: "nom1@nom2.nom3". <br>"${this.value}" n'est pas conforme.`;
              toast+=`<br>"${this.value}" n'est pas conforme.`;
              document.querySelector('p.alert').innerHTML= toast;
              champs.value='';
            }

            if (this.value) {this.value.style.fontVariant='all-petite-caps'}
            
            let estOk = verifChamp(this, this.required, 6, 99);
            let cible = document.querySelector('[type="submit"]');
            actualizeBouton(estOk, cible);
          }

          // Si une touche est pressée dans le champs mél,
          onkeyup=function() 
          {
            if (this.value) {this.value.style.fontVariant='none'}

            // Si la semantique du mél renseigné est valide,
            if (eMailRules.test(this.value))
            {
              document.querySelector('p.alert').innerHTML=``;
              champs.style.borderColor='#ccccccff';
            }
            // Si la semantique du mél renseigné est incorrecte,
            else
            {
              toast=`Le ${champs.placeholder} doit être sous la forme: "nom1@nom2.nom3". <br>"${this.value}" n'est pas conforme.`;
              toast+=`<br>"${this.value}" n'est pas conforme.`;
              document.querySelector('p.alert').innerHTML= toast;
              champs.value='';
            }

            if (this.value) {this.value.style.fontVariant='all-petite-caps'}

            verifChamp(this, this.required, 6, 99);
          }
        }
        with (document.forms.user.tel) 
        {
          // Si le numéro de client perd le focus,
          onblur=function() 
          {
            let estOk = verifChamp(this, this.required, 10, 10);
            let cible = document.querySelector('[type="submit"]');
            actualizeBouton(estOk, cible);
          }

          // Si une touche est pressée dans le champs numéro de client,
          onkeyup=function() 
          {
            verifChamp(this, this.required, 10, 10);
          }
        }
      //#endregion

      //#region -[ FONCTIONS APPELLEES ]
        function verifChamp(e, estRequis, minC, maxC) 
        {
          //#region Déclarations & Initialisations
          let bonResultat=true;
          let ancienneValeur;
          if (this.value!='') {ancienneValeur=this.value}
          e.value= e.value.trim();
          //#endregion

          //#region Si le champs contient un certain nombre de caractères, 
          if (e.value.length<=maxC && e.value.length>=minC) 
          {
            console.log(e.value.length+' respecte min et max');
            toast=``;
            document.querySelector('p.alert').innerHTML=toast;
          }
          else if (e.value.length>0) 
          {
            console.log('nb ne respecte rien');
            this.value=ancienneValeur;
            toast=`Le champs ${e.placeholder} doit comporter ${minC} chiffres`;
            document.querySelector('p.alert').innerHTML= toast;
            bonResultat=false;
          }
          
          if (estRequis && !bonResultat || e.value=='') 
          {
            bonResultat=false;
          }

          return bonResultat;
          //#endregion
        }
        function actualizeBouton(formValide, bouton) 
        {
          if (formValide) 
          {
            bouton.disabled=false;
          }
          else {
            bouton.disabled=true;
            document.forms.user.action='writePage()';
          }
        }
        
        function writePage() 
        {
          let contenu='';
          contenu+='HELLO'; //ooo
          let compte = window.open('', "_self");
          compte.title='Mon compte';
          compte.document.write(contenu);
        }
      //#endregion
    </script>
  </body>
</html>