<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <link href="./css/AFPA_Web_Partie3_d.css" rel="stylesheet">
  <title>Controles de saisie</title>
</head>

<body role="main">
  <section>
    <h1>Controles de saisie</h1>
    <label>Nom :* </label><input type="text" placeholder="nom" class="requis" tabindex="1">
    <label>Prénom :* </label><input type="text" placeholder="prenom" class="requis" tabindex="2">
    <label>Numéro : </label><input type="text" placeholder="numero membre" class="nombre" tabindex="3" maxlength="8">
    <label>Rue :* </label><input type="text" placeholder="numero et nom de rue" class="requis" tabindex="4">
    <label>Ville : </label><input type="text" placeholder="ville" tabindex="5">
    <label>CP : </label><input type="text" placeholder="code postal" class="nombre" tabindex="6" maxlength="5">
    <label>Email : </label><input type="text" placeholder="mel" tabindex="7">
    <label>Téléphone : </label><input type="text" placeholder="telephone" class="nombre" tabindex="8" maxlength="10">
    <button tabindex="9" class="submit" disabled>Validation</button>
    <p class="alert"></p>
  </section>
</body>

<script>
  // DECLARATIONS
  var toast;

  // HANDLERS
  
  // Verification des Champs (éléments de la dom avec comme class: "requis")
  for (i=0; i<document.querySelectorAll("input").length; i++) 
  {
    console.log('Check1!'); //DEBUG
    
    let e= document.querySelectorAll("input")[i];
    let estRequis;

    e.onblur=function() 
    {
      if (e.className.includes("requis")) 
      {
        estRequis= true;
      }
      else {
        estRequis= false;
      }

      console.log('Check2!'); //DEBUG
      if (champsValide(e, estRequis)) 
      {
        document.querySelector('button.submit').disabled= false;
      } 
      else {
        document.querySelector('button.submit').disabled= true;
      }
    }
  }
  
  // FONCTIONS APPELLEES
  
  function champsValide(champs, estObligatoire) {
    
    console.log('Check3!'); //DEBUG

    // Initialisations
    champs.value= champs.value.trim();
    // Si le champs est un nombre
    if (champs.className.includes('nombre')) 
    {
      let previous_value= '';
      if (! isNaN(champs.value) && champs.value!='') 
      {
        console.log('C est un nombre !'); //DEBUG
        previous_value= champs.value;
      } 
      else  
      {
      console.log('C est plus un nombre !'); //DEBUG
        champs.value= previous_value;
        document.querySelector('p').innerHTML=`Le champs ${champs.placeholder} n admet que des chiffres`;
      }

      champs.onchange=function() 
      {
        if (isNaN(champs.value)) 
        {
        console.log('C est plus un nombre !'); //DEBUG
          champs.value= previous_value;
          document.querySelector('p').innerHTML=`Le champs ${champs.placeholder} n admet que des chiffres`;
        } else {
          previous_value= champs.value;
        }
      }
    }
    // Si le champs est vide
    if (estObligatoire && champs.value=="") 
    {
      champs.style.borderColor='red';
      toast= `Le champs ${champs.placeholder} est obligatoire`;
      document.querySelector('p.alert').innerHTML= toast;
      return false;
    }
    else
    {
      champs.style.borderColor='#ccc';
      toast= ``;
      document.querySelector('p.alert').innerHTML= toast;
      return true;
    }
  }
  
</script>

</html>