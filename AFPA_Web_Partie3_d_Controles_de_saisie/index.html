<!-- A FAIRE 
  • Page à appeler via le formulaire
-->
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <link href="./css/AFPA_Web_Partie3_d.css" rel="stylesheet">
    <title>Controles de saisie</title>
  </head>
  <body role="main">
    <form action="" method="GET" name="inscription">

      <h1>Controles de saisie</h1>

      <label>Nom : </label>
      <input 
      type="text" 
      tabindex="1" 
      name="nom" 
      placeholder="nom *" 
      title="Deux caractères minuimum sont attendus" 
      pattern="^(.{2,})$" 
      value="Toto" 
      required autofocus
      >

      <label>Prénom : </label>
      <input 
      type="text" 
      tabindex="2" 
      name="prenom" 
      placeholder="prénom *" 
      title="2 caractères minuimum sont attendus" 
      pattern="^(.{2,})$"
      value="Dupont"  
      required
      >

      <label>Numéro : </label>
      <input 
      type="number" 
      tabindex="3" 
      name="numero" 
      placeholder="numéro membre" 
      title="8 chiffres sont attendus" 
      pattern="^[0-9]{8}$"
      value="" 
      >

      <label>Rue : </label>
      <input 
      type="text" 
      tabindex="4"
      name="rue" 
      placeholder="numéro et nom de rue *"  
      title="Exemple: ''12 boulevard Machin'''" 
      pattern="^([0-9]{1,4} {1}[a-zA-Z]{1,} {1}[a-zA-Z]{1,})$" 
      value="22 rue Machin" 
      required
      >

      <label>Ville : </label>
      <input 
      type="text" 
      tabindex="5" 
      name="ville" 
      placeholder="ville" 
      title="2 caractères minuimum sont attendus" 
      pattern=".{2,}"
      value="" 
      >
      
      <label>CP : </label>
      <input 
      type="number" 
      tabindex="6" 
      name="cp" 
      placeholder="code postal" 
      title="5 chiffres sont attendus. Exemple: ''68200''" 
      pattern="^([0-9]{6})$"
      value="" 
      >

      <label>Email : </label>
      <input 
      type="text" 
      tabindex="7" 
      name="mel" 
      placeholder="mél" 
      title="Exemple: ''pseudo@domain.fr'''" 
      pattern="^([a-z]{1}[a-z0-9\_\-\.]*\@[a-z0-9\_\-\.]*\.[a-z]{2,3})$"
      value="" 
      >

      <label>Téléphone : </label>
      <input 
      type="number" 
      tabindex="8" 
      name="tel" 
      placeholder="numéro de téléphone" 
      title="10 chiffres sans espaces sont attendus. Exemple: ''0668123456'''" 
      pattern="^[0-9]{10}$"
      value="" 
      >

      <input 
      type="submit" 
      tabindex="9" 
      name="valider" 
      value="Validation" 
      >

      <label tabindex="999" id="toast" value=""></label>

    </form>
    <script>
    // DECLARATION PUBLIQUE
    var toast='';
    //#endregion

    // LISTERNER sur un champs de formulaire
    document.forms.inscription.onsubmit=function(event) 
    {
      event.preventDefault();
      
      // Déclarations et initialisations
      
      let nb= eval(document.querySelectorAll('input[type="text"]').length);
      nb+= eval(document.querySelectorAll('input[type="number"]').length);
      
      let contenu='<table>';
      contenu+=  '<tr>';
      contenu+=   '<th>Champs</th>';
      contenu+=   '<th>Valeur</th>';
      contenu+=  '</tr>';

      var e, estValide;
      
      // Traitement 
      
      for (i=0; i<nb; i++)
      {
        e=document.querySelectorAll('input')[i];
        e.value=e.value.trim();
        
        /* Pour ma FAQ: On verfie que "element.value.match(pattern)" Et non que "patern.test(element.value)" car la fonction test ne peut tester une expression reguliere contenue dans une variable. */
        
        if (e.value.match(e.pattern) || (!e.required && (e.value.length<1 || e.value===undefined))) 
        {
          let champs=document.querySelectorAll('input')[i].placeholder;
          let valeur=document.querySelectorAll('input')[i].value;
          contenu+=  '<tr>';
          contenu+=   `<td> ${champs}</td>`;
          contenu+=   `<td> ${valeur}</td>`;
          contenu+=  '</tr>';
          estValide=true;
        }
      
        else if (e.required)
        {
          estValide=false;
        }
        
        alert(e.placeholder+' = '+e.pattern+' is '+estValide); //DEBUG
        
      }
      contenu+= '</table>';
      
      if (estValide) 
      {
        toast='';
        document.getElementById('toast').innerHTML=toast;
        
        let mon_compte = window.open('', '_self');
        mon_compte.title='Mon compte';
        mon_compte.document.write(contenu);
        
        return true;
      }
      
      else 
      {
        toast=`Pour le ${e.name}, ${e.title}.`;
        document.getElementById('toast').innerHTML=toast;
        
        return false;
      }
      
    }
    </script>
  </body>
</html>