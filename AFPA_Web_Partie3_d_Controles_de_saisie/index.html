<!-- AFAIRE : 
  TOUT ;___;
-->

<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <link href="./css/AFPA_Web_Partie3_d.css" rel="stylesheet">
  <title>Controles de saisie</title>
</head>

<body role="main">
  <section>

    <h1>Controles de saisie</h1>

    <label>Nom :* </label>
    <input type="text" placeholder="nom" tabindex="1" required>

    <label>Prénom :* </label>
    <input type="text" placeholder="prenom" tabindex="2" required>

    <label>Numéro : </label>
    <input type="number" placeholder="numero membre" class="nombre" tabindex="3" maxlength="8">

    <label>Rue :* </label>
    <input type="text" placeholder="numero et nom de rue" tabindex="4" required>

    <label>Ville : </label>
    <input type="text" placeholder="ville" tabindex="5">

    <label>CP : </label>
    <input type="number" placeholder="code postal" class="nombre" tabindex="6" maxlength="5">

    <label>Email : </label>
    <input type="text" placeholder="mel" tabindex="7">

    <label>Téléphone : </label>
    <input type="number" placeholder="telephone" class="nombre" tabindex="8" maxlength="10">

    <button type="submit" tabindex="9" disabled>Validation</button>

    <p class="alert"></p>

  </section>
</body>

<script>

  //#region -[ DECLARATIONS PUBLIQUES ]
  var toast=``;
  //#endregion

  //#region -[ LISTERNERS sur les champs 'input' ]
  with (document.querySelector('input[placeholder="nom"]')) 
  {
    // Si le nom perd le focus,
    onblur=function() 
    {
      let cible= document.querySelector('[type="submit"]');
      actualizeBouton(verifChamp(this), cible);
    }

    // Si une touche est pressée dans le champs nom,
    e.onkeyup=function()
    {
      let cible= document.querySelector('[type="submit"]');
      verifChamp(this);
    }
  }
  //#endregion

  //#region -[ FONCTIONS APPELLEES ]
  function verifChamp(e) {

    let estRequis= e.required;
    let doitEtreUnNombre;
    e.type=="nombre"? doitEtreUnNombre=true: doitEtreUnNombre=false;
    
    // Déclarations & Initialisations
    let resultat=true;
    champs.value= champs.value.trim();

    // Si le champs en question est requis mais vide (classe "requis"),
    if (estRequis && champs.value=='') 
    {
      champs.style.borderColor='red';
    }
    // Si le champs en question est requis et renseigné (classe "requis"),
    else if (champs.value!='')
    {
      champs.style.borderColor='#ccc';
    }

    // Si le champs en question est celui du mél (placeholder "mel"), //BUG
    if (champs.placeholder=='mel')
    {
      // Declarations et initialisations
      let melRules= /[a-z]{1}[a-z0-9\_\-\.]*\@[a-z0-9\_\-\.]*\.[a-z]{2,3}/;
      let resulat= true;
      this.value.style.fontVariant='none';

      // Si la semantique du mél renseigné est correcte,
      if (melRules.test(this.value))
      {
        champs.style.borderColor='#ccccccff';
        toast=``;
        document.querySelector('p.alert').innerHTML= toast;
        resultat= false;
      }
      // Si elle est incorrecte,
      else
      {
        champs.style.borderColor='#ff0000ff';
        toast=`Le ${champs.placeholder} doit être sous la forme: nom1@nom2.nom3`;
        document.querySelector('p.alert').innerHTML= toast;
      }

      this.value.style.fontVariant='all-petite-caps';
    }
    
    // Si le champs doit contenir un nombre (classe "nombre"), //BUG
    if (doitEtreUnNombre) 
    {
      // S'il contient un nombre,
      if (! isNaN(champs.value) && champs.value!='') 
      {
        toast=``;
        document.querySelector('p.alert').innerHTML= toast;
      }
      // S'il contient autre chose qu'un nombre,
      else if (isNaN(champs.value)) 
      {
        this.value.slice(0, -1);
        toast=`Le champs ${champs.placeholder} n\'admet que des chiffres`;
        document.querySelector('p.alert').innerHTML= toast;
      }
    }
    
    return resultat;
  }

  function actualizeBouton(formValide, bouton) {

    if (formValide) 
    {
      document.querySelector('button.submit').disabled= false;
    }
    else {
      document.querySelector('button.submit').disabled= true;
    }
  }
  //#endregion

</script>

</html>