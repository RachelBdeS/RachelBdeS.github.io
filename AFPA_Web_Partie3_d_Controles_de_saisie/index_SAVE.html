<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <link href="./css/AFPA_Web_Partie3_d.css" rel="stylesheet">
  <title>Controles de saisie</title>
</head>

<body role="main">
  <section>

    <h1>Controles de saisie</h1>

    <label>Nom :* </label>
    <input type="text" placeholder="nom" class="requis" tabindex="1">

    <label>Prénom :* </label>
    <input type="text" placeholder="prenom" class="requis" tabindex="2">

    <label>Numéro : </label>
    <input type="text" placeholder="numero membre" class="nombre" tabindex="3" maxlength="8">

    <label>Rue :* </label>
    <input type="text" placeholder="numero et nom de rue" class="requis" tabindex="4">

    <label>Ville : </label><input type="text" placeholder="ville" tabindex="5">

    <label>CP : </label><input type="text" placeholder="code postal" class="nombre" tabindex="6" maxlength="5">

    <label>Email : </label>
    <input type="text" placeholder="mel" tabindex="7">

    <label>Téléphone : </label>
    <input type="text" placeholder="telephone" class="nombre" tabindex="8" maxlength="10">

    <button tabindex="9" class="submit" disabled>Validation</button>

    <p class="alert"></p>

  </section>
</body>

<script>

  //#region -[ DECLARATIONS PUBLIQUES ]
  var toast=``;
  //#endregion

  //#region -[ LISTERNERS sur les champs 'input' ]
  for (i=0; i<document.querySelectorAll('input').length; i++) {

    // Déclarations
    let e=document.querySelectorAll('input')[i];
    let estRequis;

    // Si un champs perd le focus,
    e.onblur=function() 
    {
      e.className.includes('requis')? estRequis=true: estRequis= false;

      if (champsValide(e, estRequis)) {
        actualizeBouton(resultat, document.querySelector('button.submit'));
      }
    }

    // Si un champs est modifié,
    e.onchange=function()
    {
      if (e.className.includes('nombre'))
      {
        e.className.includes('requis')? estRequis=true: estRequis= false;
        
        if (champsValide(e, estRequis)) {
          actualizeBouton(resultat, document.querySelector('button.submit'));
        }
      }
    }
  }
  //#endregion

  //#region -[FONCTIONS APPELLEES ]
  function champsValide(champs, estObligatoire) {

    // Déclarations & Initialisations
    let resultat=true;
    champs.value= champs.value.trim();

    // Si le champs en quesiton est un nombre (classe "nombre"),
    if (champs.className.includes('nombre')) 
    {
      // Si le nombre est reconnu,
      if (! isNaN(champs.value) && champs.value!='') 
      {
        champs.style.borderColor='#ccccccff';
        toast=``;
        document.querySelector('p.alert').innerHTML= toast;
        resultat= true;
      } 
      // S'il n'est pas reconnu,
      else if (isNaN(champs.value)) 
      {
        champs.style.borderColor='#ff0000ff';
        toast=`Le champs ${champs.placeholder} n\'admet que des chiffres`;
        document.querySelector('p.alert').innerHTML= toast;
        resultat= false;
      }
    }

    // Si le champs en question est requis mais vide (classe "requis"),
    if (estObligatoire && champs.value=='') 
    {
      champs.style.borderColor='red';
      toast= `Le champs ${champs.placeholder} est obligatoire`;
      document.querySelector('p.alert').innerHTML= toast;
      resultat= false;
    }
    // S'il est requis et renseigné,
    else if (champs.value!='')
    {
      champs.style.borderColor='#ccc';
      toast='';
      document.querySelector('p.alert').innerHTML= toast;
      resultat= true;
    }

    // Si le champs en question est celui du mél (placeholder "mel"),
    if (champs.placeholder=='mel')
    {
      // Declarations et initialisations
      let melRules= /[a-z]{1}[a-z0-9\_\-\.]*\@[a-z0-9\_\-\.]*\.[a-z]{2,3}/;
      let resulat= true;
      this.value.style.fontVariant='none';

      // Si la semantique du mél renseigné est correcte,
      if (melRules.test(this.value))
      {
        champs.style.borderColor='#ccccccff';
        toast=``;
        document.querySelector('p.alert').innerHTML= toast;
        resultat= false;
      }
      // Si elle est incorrecte,
      else
      {
        champs.style.borderColor='#ff0000ff';
        toast=`Le ${champs.placeholder} doit être sous la forme: nom1@nom2.nom3`;
        document.querySelector('p.alert').innerHTML= toast;
      }

      this.value.style.fontVariant='all-petite-caps';
    }

    return resultat;
  }

  function actualizeBouton(formValide, bouton) {

    if (formValide) 
    {
      document.querySelector('button.submit').disabled= false;
    }
    else {
      document.querySelector('button.submit').disabled= true;
    }
  }
  //#endregion

</script>

</html>